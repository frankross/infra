global_defs {
 router_id LVS_DEVEL
}

vrrp_script chk_haproxy {
 script "killall -0 haproxy"
 interval 20
 weight 20
}

vrrp_instance VI_1 {
state <%= @state%>
interface eth0
notify_master "/etc/keepalived/vrrp.sh MASTER"
notify_fault "/etc/keepalived/vrrp.sh FAULT"
virtual_router_id 51
priority <%= @priority%>
advert_int 1
authentication {
auth_type PASS
auth_pass 1111
}

#nopreempt
<% if @peers && !@peers.empty? %>
  unicast_peer {
    <% @peers.each do |address| %>
    <%= address %>
    <% end %>
  }
<% end %>
track_script {
 chk_haproxy weight 20
}

}
